import heapq
import folium
from math import radians, sin, cos, sqrt, atan2

# Haversine fonksiyonu: İki nokta arasındaki mesafeyi hesaplar (km cinsinden)
def haversine(coord1, coord2):
    lat1, lon1 = coord1
    lat2, lon2 = coord2
    lat1, lon1, lat2, lon2 = map(radians, [lat1, lon1, lat2, lon2])
    
    dlat = lat2 - lat1
    dlon = lon2 - lon1
    a = sin(dlat / 2) ** 2 + cos(lat1) * cos(lat2) * sin(dlon / 2) ** 2
    c = 2 * atan2(sqrt(a), sqrt(1 - a))
    
    return 6371 * c  # Yerçekimi sabiti (yaklaşık 6371 km)

# Dijkstra algoritması
def dijkstra(graph, start, end):
    pq = [(0, start)]
    distances = {start: 0}
    previous_nodes = {start: None}
    
    while pq:
        current_distance, current_node = heapq.heappop(pq)
        
        if current_node == end:
            path = []
            while previous_nodes[current_node] is not None:
                path.insert(0, current_node)
                current_node = previous_nodes[current_node]
            path.insert(0, start)  # Başlangıç noktasını ekle
            return path, current_distance
        
        for neighbor, weight in graph.get(current_node, []):
            distance = current_distance + weight
            
            if neighbor not in distances or distance < distances[neighbor]:
                distances[neighbor] = distance
                previous_nodes[neighbor] = current_node
                heapq.heappush(pq, (distance, neighbor))
    
    return None, float("inf")

# Grafik oluşturma

nodes = [
    {
        "name": "Düğüm 1",
        "coordinates": [
            38.67199887559011,
            34.74274992942811
        ]
    },
    {
        "name": "Düğüm 2",
        "coordinates": [
            38.672250690288536,
            34.742782115936286
        ]
    },
    {
        "name": "Düğüm 3",
        "coordinates": [
            38.67253548588628,
            34.74273383617402
        ]
    },
    {
        "name": "Düğüm 4",
        "coordinates": [
            38.67275326999068,
            34.74272847175599
        ]
    },
    {
        "name": "Düğüm 5",
        "coordinates": [
            38.67293336019192,
            34.7426587343216
        ]
    },
    {
        "name": "Düğüm 6",
        "coordinates": [
            38.67328097488052,
            34.7422081232071
        ]
    },
    {
        "name": "Düğüm 7",
        "coordinates": [
            38.67334798474692,
            34.7432166337967
        ]
    },
    {
        "name": "Düğüm 8",
        "coordinates": [
            38.674026456111314,
            34.742057919502265
        ]
    },
    {
        "name": "Düğüm 9",
        "coordinates": [
            38.67416047438568,
            34.743077158927925
        ]
    },
    {
        "name": "Düğüm 10",
        "coordinates": [
            38.674914322503895,
            34.742304682731636
        ]
    },
    {
        "name": "Düğüm 11",
        "coordinates": [
            38.67295011274575,
            34.74198818206788
        ]
    },
    {
        "name": "Düğüm 12",
        "coordinates": [
            38.67296686529566,
            34.74121034145356
        ]
    },
    {
        "name": "Düğüm 13",
        "coordinates": [
            38.67308413303524,
            34.741103053092964
        ]
    },
    {
        "name": "Düğüm 14",
        "coordinates": [
            38.67302549918947,
            34.74028229713441
        ]
    },
    {
        "name": "Düğüm 15",
        "coordinates": [
            38.6732600342844,
            34.74025547504426
        ]
    },
    {
        "name": "Düğüm 16",
        "coordinates": [
            38.67356157827741,
            34.740303754806526
        ]
    },
    {
        "name": "Düğüm 17",
        "coordinates": [
            38.67387987333643,
            34.73998725414277
        ]
    },
    {
        "name": "Düğüm 18",
        "coordinates": [
            38.674344749103255,
            34.740309119224555
        ]
    },
    {
        "name": "Düğüm 19",
        "coordinates": [
            38.674667228717546,
            34.740791916847236
        ]
    },
    {
        "name": "Düğüm 20",
        "coordinates": [
            38.674453638486135,
            34.73965466022492
        ]
    },
    {
        "name": "Düğüm 21",
        "coordinates": [
            38.6744871428783,
            34.74190771579743
        ]
    },
    {
        "name": "Düğüm 22",
        "coordinates": [
            38.674587655960735,
            34.74291622638703
        ]
    },
    {
        "name": "Düğüm 23",
        "coordinates": [
            38.674453638486135,
            34.74123179912568
        ]
    },
    {
        "name": "Düğüm 24",
        "coordinates": [
            38.675513207294486,
            34.74166631698609
        ]
    },
    {
        "name": "Düğüm 25",
        "coordinates": [
            38.675546275774174,
            34.74137663841248
        ]
    },
    {
        "name": "Düğüm 26",
        "coordinates": [
            38.67632148441661,
            34.742047190666206
        ]
    },
    {
        "name": "Düğüm 27",
        "coordinates": [
            38.676673270572415,
            34.74160730838776
        ]
    },
    {
        "name": "Düğüm 28",
        "coordinates": [
            38.676685834331714,
            34.7422617673874
        ]
    },
    {
        "name": "Düğüm 29",
        "coordinates": [
            38.6769957396964,
            34.74250853061677
        ]
    },
    {
        "name": "Düğüm 30",
        "coordinates": [
            38.67754854052892,
            34.74275529384614
        ]
    },
    {
        "name": "Düğüm 31",
        "coordinates": [
            38.67308109071118,
            34.744262695532456
        ]
    },
    {
        "name": "Düğüm 32",
        "coordinates": [
            38.673324001856656,
            34.74424123786033
        ]
    },
    {
        "name": "Düğüm 33",
        "coordinates": [
            38.67319417014008,
            34.744815230589516
        ]
    },
    {
        "name": "Düğüm 34",
        "coordinates": [
            38.673248615727324,
            34.745115637999184
        ]
    },
    {
        "name": "Düğüm 35",
        "coordinates": [
            38.67404854227392,
            34.74516391776145
        ]
    },
    {
        "name": "Düğüm 36",
        "coordinates": [
            38.674446408169956,
            34.74523901961387
        ]
    },
    {
        "name": "Düğüm 37",
        "coordinates": [
            38.674478766781746,
            34.74585592746735
        ]
    },
    {
        "name": "Düğüm 38",
        "coordinates": [
            38.67423585955476,
            34.745845198631294
        ]
    },
    {
        "name": "Düğüm 39",
        "coordinates": [
            38.67450808311545,
            34.74691271781922
        ]
    },
    {
        "name": "Düğüm 40",
        "coordinates": [
            38.67427355210955,
            34.74686443805695
        ]
    },
    {
        "name": "Düğüm 41",
        "coordinates": [
            38.67449970702132,
            34.74822700023652
        ]
    },
    {
        "name": "Düğüm 42",
        "coordinates": [
            38.674407569921286,
            34.74822163581849
        ]
    },
    {
        "name": "Düğüm 43",
        "coordinates": [
            38.674491330926216,
            34.749085307121284
        ]
    },
    {
        "name": "Düğüm 44",
        "coordinates": [
            38.67418141471838,
            34.74946081638337
        ]
    },
    {
        "name": "Düğüm 45",
        "coordinates": [
            38.6749855188603,
            34.74793195724488
        ]
    },
    {
        "name": "Düğüm 46",
        "coordinates": [
            38.67511115931652,
            34.748028516769416
        ]
    },
    {
        "name": "Düğüm 47",
        "coordinates": [
            38.675630470862686,
            34.74619925022126
        ]
    },
    {
        "name": "Düğüm 48",
        "coordinates": [
            38.67576448613397,
            34.746290445327766
        ]
    },
    {
        "name": "Düğüm 49",
        "coordinates": [
            38.67620422198047,
            34.74425196647645
        ]
    },
    {
        "name": "Düğüm 50",
        "coordinates": [
            38.67654763285809,
            34.74448800086976
        ]
    },
    {
        "name": "Düğüm 51",
        "coordinates": [
            38.67529961958737,
            34.743586778640754
        ]
    },
    {
        "name": "Düğüm 52",
        "coordinates": [
            38.67488081831165,
            34.74348485469819
        ]
    },
    {
        "name": "Düğüm 53",
        "coordinates": [
            38.67470910908036,
            34.74416613578797
        ]
    },
    {
        "name": "Düğüm 54",
        "coordinates": [
            38.67493526261607,
            34.74421977996827
        ]
    },
    {
        "name": "Düğüm 55",
        "coordinates": [
            38.67495620272211,
            34.74410712718964
        ]
    },
    {
        "name": "Düğüm 56",
        "coordinates": [
            38.67451227116215,
            34.74395692348481
        ]
    },
    {
        "name": "Düğüm 57",
        "coordinates": [
            38.67446620263503,
            34.744069576263435
        ]
    },
    {
        "name": "Düğüm 58",
        "coordinates": [
            38.675006458951636,
            34.74020719528199
        ]
    },
    {
        "name": "Düğüm 59",
        "coordinates": [
            38.675810553825514,
            34.73940789699555
        ]
    },
    {
        "name": "Düğüm 60",
        "coordinates": [
            38.67604926775233,
            34.73872661590577
        ]
    },
    {
        "name": "Düğüm 61",
        "coordinates": [
            38.67604926775233,
            34.73816871643067
        ]
    },
    {
        "name": "Düğüm 62",
        "coordinates": [
            38.676141402739205,
            34.73653256893159
        ]
    },
    {
        "name": "Düğüm 63",
        "coordinates": [
            38.676246101444,
            34.736098051071174
        ]
    },
    {
        "name": "Düğüm 64",
        "coordinates": [
            38.672971053432505,
            34.739831686019905
        ]
    },
    {
        "name": "Düğüm 65",
        "coordinates": [
            38.67393431840215,
            34.7387856245041
        ]
    },
    {
        "name": "Düğüm 66",
        "coordinates": [
            38.672803527766845,
            34.74288940429688
        ]
    },
    {
        "name": "Düğüm 67",
        "coordinates": [
            38.67207478655921,
            34.743082523345954
        ]
    },
    {
        "name": "Düğüm 68",
        "coordinates": [
            38.672975241569155,
            34.74273383617402
        ]
    },
    {
        "name": "Düğüm 69",
        "coordinates": [
            38.67464210048812,
            34.74338293075562
        ]
    },
    {
        "name": "Düğüm 70",
        "coordinates": [
            38.67560534297139,
            34.74272847175599
        ]
    },
    {
        "name": "Düğüm 71",
        "coordinates": [
            38.67681565971537,
            34.74298059940339
        ]
    },
    {
        "name": "Düğüm 72",
        "coordinates": [
            38.67714231609066,
            34.743350744247444
        ]
    }
]

routes = [
    [
        [
            38.67199887559011,
            34.74274992942811
        ],
        [
            38.672250690288536,
            34.742782115936286
        ]
    ],
    [
        [
            38.672250690288536,
            34.742782115936286
        ],
        [
            38.67253548588628,
            34.74273383617402
        ]
    ],
    [
        [
            38.67253548588628,
            34.74273383617402
        ],
        [
            38.67275326999068,
            34.74272847175599
        ]
    ],
    [
        [
            38.67275326999068,
            34.74272847175599
        ],
        [
            38.67293336019192,
            34.7426587343216
        ]
    ],
    [
        [
            38.67293336019192,
            34.7426587343216
        ],
        [
            38.67328097488052,
            34.7422081232071
        ]
    ],
    [
        [
            38.67328097488052,
            34.7422081232071
        ],
        [
            38.674026456111314,
            34.742057919502265
        ]
    ],
    [
        [
            38.674026456111314,
            34.742057919502265
        ],
        [
            38.6744871428783,
            34.74190771579743
        ]
    ],
    [
        [
            38.6744871428783,
            34.74190771579743
        ],
        [
            38.674914322503895,
            34.742304682731636
        ]
    ],
    [
        [
            38.674914322503895,
            34.742304682731636
        ],
        [
            38.674587655960735,
            34.74291622638703
        ]
    ],
    [
        [
            38.674587655960735,
            34.74291622638703
        ],
        [
            38.67416047438568,
            34.743077158927925
        ]
    ],
    [
        [
            38.67416047438568,
            34.743077158927925
        ],
        [
            38.67334798474692,
            34.7432166337967
        ]
    ],
    [
        [
            38.67334798474692,
            34.7432166337967
        ],
        [
            38.672975241569155,
            34.74273383617402
        ]
    ],
    [
        [
            38.672975241569155,
            34.74273383617402
        ],
        [
            38.67293336019192,
            34.7426587343216
        ]
    ],
    [
        [
            38.672975241569155,
            34.74273383617402
        ],
        [
            38.67308109071118,
            34.744262695532456
        ]
    ],
    [
        [
            38.67308109071118,
            34.744262695532456
        ],
        [
            38.673324001856656,
            34.74424123786033
        ]
    ],
    [
        [
            38.67308109071118,
            34.744262695532456
        ],
        [
            38.67319417014008,
            34.744815230589516
        ]
    ],
    [
        [
            38.67319417014008,
            34.744815230589516
        ],
        [
            38.673248615727324,
            34.745115637999184
        ]
    ],
    [
        [
            38.673248615727324,
            34.745115637999184
        ],
        [
            38.67404854227392,
            34.74516391776145
        ]
    ],
    [
        [
            38.674446408169956,
            34.74523901961387
        ],
        [
            38.67404854227392,
            34.74516391776145
        ]
    ],
    [
        [
            38.674446408169956,
            34.74523901961387
        ],
        [
            38.67446620263503,
            34.744069576263435
        ]
    ],
    [
        [
            38.67446620263503,
            34.744069576263435
        ],
        [
            38.67451227116215,
            34.74395692348481
        ]
    ],
    [
        [
            38.67446620263503,
            34.744069576263435
        ],
        [
            38.67470910908036,
            34.74416613578797
        ]
    ],
    [
        [
            38.67470910908036,
            34.74416613578797
        ],
        [
            38.67493526261607,
            34.74421977996827
        ]
    ],
    [
        [
            38.67493526261607,
            34.74421977996827
        ],
        [
            38.67495620272211,
            34.74410712718964
        ]
    ],
    [
        [
            38.67470910908036,
            34.74416613578797
        ],
        [
            38.67488081831165,
            34.74348485469819
        ]
    ],
    [
        [
            38.67488081831165,
            34.74348485469819
        ],
        [
            38.67529961958737,
            34.743586778640754
        ]
    ],
    [
        [
            38.67464210048812,
            34.74338293075562
        ],
        [
            38.674587655960735,
            34.74291622638703
        ]
    ],
    [
        [
            38.67464210048812,
            34.74338293075562
        ],
        [
            38.67488081831165,
            34.74348485469819
        ]
    ],
    [
        [
            38.675546275774174,
            34.74137663841248
        ],
        [
            38.675513207294486,
            34.74166631698609
        ]
    ],
    [
        [
            38.675513207294486,
            34.74166631698609
        ],
        [
            38.67560534297139,
            34.74272847175599
        ]
    ],
    [
        [
            38.67560534297139,
            34.74272847175599
        ],
        [
            38.67488081831165,
            34.74348485469819
        ]
    ],
    [
        [
            38.675513207294486,
            34.74166631698609
        ],
        [
            38.67632148441661,
            34.742047190666206
        ]
    ],
    [
        [
            38.67632148441661,
            34.742047190666206
        ],
        [
            38.676673270572415,
            34.74160730838776
        ]
    ],
    [
        [
            38.676673270572415,
            34.74160730838776
        ],
        [
            38.676685834331714,
            34.7422617673874
        ]
    ],
    [
        [
            38.676685834331714,
            34.7422617673874
        ],
        [
            38.6769957396964,
            34.74250853061677
        ]
    ],
    [
        [
            38.676685834331714,
            34.7422617673874
        ],
        [
            38.67632148441661,
            34.742047190666206
        ]
    ],
    [
        [
            38.676685834331714,
            34.7422617673874
        ],
        [
            38.67620422198047,
            34.74425196647645
        ]
    ],
    [
        [
            38.67620422198047,
            34.74425196647645
        ],
        [
            38.67654763285809,
            34.74448800086976
        ]
    ],
    [
        [
            38.67754854052892,
            34.74275529384614
        ],
        [
            38.67714231609066,
            34.743350744247444
        ]
    ],
    [
        [
            38.67714231609066,
            34.743350744247444
        ],
        [
            38.67681565971537,
            34.74298059940339
        ]
    ],
    [
        [
            38.67681565971537,
            34.74298059940339
        ],
        [
            38.6769957396964,
            34.74250853061677
        ]
    ],
    [
        [
            38.67620422198047,
            34.74425196647645
        ],
        [
            38.675630470862686,
            34.74619925022126
        ]
    ],
    [
        [
            38.675630470862686,
            34.74619925022126
        ],
        [
            38.67576448613397,
            34.746290445327766
        ]
    ],
    [
        [
            38.675630470862686,
            34.74619925022126
        ],
        [
            38.6749855188603,
            34.74793195724488
        ]
    ],
    [
        [
            38.6749855188603,
            34.74793195724488
        ],
        [
            38.67511115931652,
            34.748028516769416
        ]
    ],
    [
        [
            38.6749855188603,
            34.74793195724488
        ],
        [
            38.674491330926216,
            34.749085307121284
        ]
    ],
    [
        [
            38.674491330926216,
            34.749085307121284
        ],
        [
            38.674407569921286,
            34.74822163581849
        ]
    ],
    [
        [
            38.674407569921286,
            34.74822163581849
        ],
        [
            38.67449970702132,
            34.74822700023652
        ]
    ],
    [
        [
            38.67449970702132,
            34.74822700023652
        ],
        [
            38.674491330926216,
            34.749085307121284
        ]
    ],
    [
        [
            38.67449970702132,
            34.74822700023652
        ],
        [
            38.67450808311545,
            34.74691271781922
        ]
    ],
    [
        [
            38.67450808311545,
            34.74691271781922
        ],
        [
            38.67427355210955,
            34.74686443805695
        ]
    ],
    [
        [
            38.674478766781746,
            34.74585592746735
        ],
        [
            38.67450808311545,
            34.74691271781922
        ]
    ],
    [
        [
            38.674446408169956,
            34.74523901961387
        ],
        [
            38.674478766781746,
            34.74585592746735
        ]
    ],
    [
        [
            38.674478766781746,
            34.74585592746735
        ],
        [
            38.67423585955476,
            34.745845198631294
        ]
    ],
    [
        [
            38.674491330926216,
            34.749085307121284
        ],
        [
            38.67418141471838,
            34.74946081638337
        ]
    ],
    [
        [
            38.67293336019192,
            34.7426587343216
        ],
        [
            38.67295011274575,
            34.74198818206788
        ]
    ],
    [
        [
            38.67295011274575,
            34.74198818206788
        ],
        [
            38.67296686529566,
            34.74121034145356
        ]
    ],
    [
        [
            38.67296686529566,
            34.74121034145356
        ],
        [
            38.67308413303524,
            34.741103053092964
        ]
    ],
    [
        [
            38.67296686529566,
            34.74121034145356
        ],
        [
            38.67302549918947,
            34.74028229713441
        ]
    ],
    [
        [
            38.67302549918947,
            34.74028229713441
        ],
        [
            38.672971053432505,
            34.739831686019905
        ]
    ],
    [
        [
            38.67302549918947,
            34.74028229713441
        ],
        [
            38.6732600342844,
            34.74025547504426
        ]
    ],
    [
        [
            38.6732600342844,
            34.74025547504426
        ],
        [
            38.67356157827741,
            34.740303754806526
        ]
    ],
    [
        [
            38.67356157827741,
            34.740303754806526
        ],
        [
            38.67387987333643,
            34.73998725414277
        ]
    ],
    [
        [
            38.67387987333643,
            34.73998725414277
        ],
        [
            38.674453638486135,
            34.73965466022492
        ]
    ],
    [
        [
            38.674344749103255,
            34.740309119224555
        ],
        [
            38.67387987333643,
            34.73998725414277
        ]
    ],
    [
        [
            38.67387987333643,
            34.73998725414277
        ],
        [
            38.67393431840215,
            34.7387856245041
        ]
    ],
    [
        [
            38.674344749103255,
            34.740309119224555
        ],
        [
            38.674667228717546,
            34.740791916847236
        ]
    ],
    [
        [
            38.674344749103255,
            34.740309119224555
        ],
        [
            38.674344749103255,
            34.740309119224555
        ]
    ],
    [
        [
            38.675006458951636,
            34.74020719528199
        ],
        [
            38.674344749103255,
            34.740309119224555
        ]
    ],
    [
        [
            38.675006458951636,
            34.74020719528199
        ],
        [
            38.675810553825514,
            34.73940789699555
        ]
    ],
    [
        [
            38.675810553825514,
            34.73940789699555
        ],
        [
            38.67604926775233,
            34.73872661590577
        ]
    ],
    [
        [
            38.67604926775233,
            34.73872661590577
        ],
        [
            38.67604926775233,
            34.73816871643067
        ]
    ],
    [
        [
            38.67604926775233,
            34.73816871643067
        ],
        [
            38.676141402739205,
            34.73653256893159
        ]
    ],
    [
        [
            38.676141402739205,
            34.73653256893159
        ],
        [
            38.676246101444,
            34.736098051071174
        ]
    ],
    [
        [
            38.674344749103255,
            34.740309119224555
        ],
        [
            38.674453638486135,
            34.74123179912568
        ]
    ],
    [
        [
            38.674453638486135,
            34.74123179912568
        ],
        [
            38.6744871428783,
            34.74190771579743
        ]
    ],
    [
        [
            38.67207478655921,
            34.743082523345954
        ],
        [
            38.672803527766845,
            34.74288940429688
        ]
    ],
    [
        [
            38.672803527766845,
            34.74288940429688
        ],
        [
            38.672975241569155,
            34.74273383617402
        ]
    ]
]

graph = {}
for route in routes:
    coord1, coord2 = route
    distance = haversine(coord1, coord2)
    graph.setdefault(tuple(coord1), []).append((tuple(coord2), distance))
    graph.setdefault(tuple(coord2), []).append((tuple(coord1), distance))

start_index = int(input("Başlangıç düğümünü seçin : "))  # Başlangıç düğümü (Düğüm 1'den Düğüm 9'a kadar 0-8 arası bir sayı)
end_index = int(input("Bitiş düğümünü seçin : "))  

start_index = start_index - 1    # Başlangıç düğümü      
end_index = end_index - 1     # Bitiş düğümü 

start_node = tuple(nodes[start_index]["coordinates"])
end_node = tuple(nodes[end_index]["coordinates"])

# En kısa yolu hesapla
shortest_path, shortest_distance = dijkstra(graph, start_node, end_node)

if shortest_path is None:
    print("En kısa yol bulunamadı.")
else:
    print("En kısa yol:", shortest_path)
    print("Mesafe (km):", shortest_distance)

    # Harita üzerinde görselleştirme
    map_center = nodes[start_index]["coordinates"]
    map = folium.Map(location=map_center, zoom_start=15)

    # Düğüm işaretçileri
    folium.Marker(
        location=start_node, icon=folium.Icon(color="green", icon="play"), popup="Başlangıç"
    ).add_to(map)
    folium.Marker(
        location=end_node, icon=folium.Icon(color="red", icon="stop"), popup="Bitiş"
    ).add_to(map)

    # En kısa yolun çizimi
    for i in range(len(shortest_path) - 1):
        coord1 = shortest_path[i]
        coord2 = shortest_path[i + 1]
        folium.PolyLine([coord1, coord2], color="blue", weight=5, opacity=0.7).add_to(map)

    # HTML dosyasına kaydet
    map.save("ms.html")
    print("Harita 'ms.html' olarak kaydedildi.")